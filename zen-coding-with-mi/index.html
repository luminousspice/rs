<!DOCTYPE html>
<html class="no-js" lang="ja" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
<meta name="description" content='miでZenCodingする方法。既存のPerl実装を利用して、ツールをAppleScriptで書きます。'>
<meta name="keywords" content="AppleScript, automator, mac, mi, perl, zencoding">

<meta property="og:type" content="article" />
<meta property="og:description" content='miでZenCodingする方法。既存のPerl実装を利用して、ツールをAppleScriptで書きます。'/>
<meta property="og:title" content="ZenCoding with mi" />
<meta property="og:site_name" content="the Right Stuff" />
<meta property="og:url" content="http://rs.luminousspice.com/zen-coding-with-mi/">
<meta property="og:locale" content="ja">
<meta property="og:image" content="http://rs.luminousspice.comapple-touch-icon.png" />

<meta property="article:published_time" content="2012-08-05T23:20:40Z"/>
<meta property="article:modified_time" content="2012-08-05T23:20:40Z"/>



<meta property="article:tag" content="AppleScript"><meta property="article:tag" content="automator"><meta property="article:tag" content="mac"><meta property="article:tag" content="mi"><meta property="article:tag" content="perl"><meta property="article:tag" content="zencoding">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@luminousspice">
<meta name="twitter:title" content="ZenCoding with mi">
<meta name="twitter:creator" content="@luminousspice">
<meta name="twitter:description" content='miでZenCodingする方法。既存のPerl実装を利用して、ツールをAppleScriptで書きます。'>
<meta name="twitter:image:src" content="http://rs.luminousspice.comapple-touch-icon.png">
<meta name="twitter:domain" content="luminousspice.com">

  <base href="http://rs.luminousspice.com">
  <title>ZenCoding with mi | the right stuff</title>

  <link rel="stylesheet" href="http://rs.luminousspice.com/css/rs.css">

  <link rel="apple-touch-icon" href="http://rs.luminousspice.com/apple-touch-icon.png">
  <link rel="shortcut icon" href="http://rs.luminousspice.com/favicon.ico" type="image/x-icon">
  
  <link rel="canonical" href="http://rs.luminousspice.com/zen-coding-with-mi/">
  <link href="http://rs.luminousspice.com/index.xml" rel="alternate" type="application/rss+xml" title="the Right Stuff" />
  <link href="http://rs.luminousspice.com/index.xml" rel="feed" type="application/rss+xml" title="the Right Stuff" />
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    このコンテンツは @luminousspice が非同期的に更新しています。経時的な順序に意味はありません。
  </div>

  <nav class="sidebar-nav">
    
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/table-of-contents/">総目次</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/index-how-to-anki/">Anki 索引</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/post/">アーカイブ</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/search/">全文検索</a>
    
  </nav>

  <div class="sidebar-item">
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="http://rs.luminousspice.com/" title="Home">the Right Stuff</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <article class="post">
  <h1 class="post-title">ZenCoding with mi</h1>
  <span class="post-date"><time datetime="2012-08-05T23:20:40Z">2012-08-05</time></span>
  <hr>

<p><h3>ご注意:</h3>
2013.5.30追記
miの最新版、<a href="http://www.mimikaki.net/" target="_blank">mi3</a>ではZencodingの機能が実装になりました。この記事で取り上げている内容よりも豊富な機能を提供しています。ぜひmi3を使ってください。</p>

<p><img src="http://rs.luminousspice.com/images/mi3.png" alt="mi3" /></p>

<p><h4>mi3のZencoding機能を使う方法</h4>
<p>機能の呼び出し方は、ドキュメントモードを[HTML]か[HTML5]に設定した上で、展開したい箇所を選択して(Control+Command+E)を押します。</p></p>

<p>ドキュメントモードの設定方法はドキュメントウィンドウ上部のプルダウンリストから選択するか、メニューバーから[ドキュメント]>[モード]>[HTML5]/[HTML]を選択します。
    </p>
<p>メニューバーから[ツール]>[HTML]>[_zencoding]を選択すると、下図のような展開以外の機能を呼び出すことができます。</p>

<p><img src="http://rs.luminousspice.com/images/mi3zencoding.png" alt="mi3zencoding" /></p>

<p>この記事は、役割を終えたことになります。</p>
<hr>
<h2>miでもZenCodingしたい</h2>
<p>と思い続けていたところ、<a href="http://d.hatena.ne.jp/makog/20110706/1309969364">Jedit Xで動作させている記事</a>を発見しました。</p>
<p>この記事によれば、作者のmakogさんは、OtchyさんのZencodingの<a href="http://www.otchy.net/20100225/zen-coding-for-perl/">Perlモジュール実装</a>を使って、Jedit XのマクロをAppleScriptで作成したそうです。アクションの内、省略記法の展開が使えるようになっています。
おお、素晴らしい、miで使うのに一気に敷居が下がりました。</p>

<p>そこで、この記事を参考にmi用にAppleScriptを書き起こしました。miのツールにzencodingの機能を追加できました。</p>
<img src="http://rs.luminousspice.com/images/mi-zencoding.png" alt="完成図" />
<strong>図 1. 完成図</strong>


<h2>はじめにご理解いただきたいこと</h2>

<p>この記事で作成するアプリケーションは、Mac OS X 10.7.4、このOSに付属しているPerl 5.12.3とAutomator 2.2.4を使って作成し、mi 2.1.12r1で動作確認しました。利用環境の違いによっては動作しない場合も予想されます。この記事は、自分の環境で動作するように一人で修正できる方に向けて書いています。</p>

<h2>準備作業</h2>

<p>前提条件として<a href="http://www.otchy.net/20100225/zen-coding-for-perl/">SSSCoding.pm</a>のインストールが必要です。
    このPerlモジュールのインストール先は、たとえばターミナルから次のコマンドで調べることが出来ます。</p>
<pre>perl -e 'print $i++ . ":" . "$_\n" foreach @INC'</pre>
Mac OS X 10.7 では、/Library/Perl/5.12 でした。

<h2>mi用AppleScriptの作成</h2>

<p>miのヘルプの説明を参考にAppleScriptを次のように書きました。</p>
<div class="highlight"><pre>tell document 1 of application "mi"
    set startP to index of paragraph 1 of selection object 1
    set endP to startP + (count paragraph of selection object 1) - 1
    repeat with i from startP to endP
        set str to paragraph i
        set res1 to do shell script "perl -e 'chomp($ARGV[0]);print $ARGV[0];'" &amp; " " &amp; quoted form of str
        set res to do shell script "perl -MSSSCoding -e 'print SSSCoding::expand($ARGV[0]);'" &amp; " " &amp; quoted form of res1
        set paragraph i to res &amp; (ASCII character 10)
    end repeat
end tell</pre></div>
<strong>表 1. zencoding.scpt</strong>

<h2>インストール</h2>
<p>このスクリプトをAppleScript エディタで、スクリプト(.scpt)形式で保存します。
そのファイルを、モード設定ウインドウ→ツールタブの左側のツール一覧にドラッグすると使えるようになります。</p>

<p><img src="http://rs.luminousspice.com/images/mi-mode-setting.png" alt="インストール先-モード設定ウィンドウ"  />
<strong>図 2. インストール先-モード設定ウィンドウ</strong></p>

<p>手作業でインストールする場合は、標準モードのツールとして使うなら、
    <code>~/Library/Application Support/mi/mode/Normal/tool</code>
になります。 </p>

<p>ZenCodingの省略記法した箇所を選択して、メニューから<strong>ツール</strong>-<strong>zencoding</strong>と選択してツールを実行するすると、選択範囲が展開されます。また、コンテクストメニューからも同様に選択して実行できます。(図 1. 完成図 参照)
    これで、miでZenCodingするという目的が達成できました。</p>

<p>なお、今回実装した省略記法の展開以外にも、ZenCodingの<a href="http://code.google.com/p/zen-coding/wiki/Actions">アクション</a>には、編集箇所の移動など便利な機能が含まれています。</p>

<p><h2>完成品も用意しました</h2>
<a href="https://github.com/luminousspice/zencoding-mi">GitHubにscptファイルの完成品を置きました</a>。</p>

<p><h2>ところが</h2>
<p>作っているうちに、これをautomatorのサービスにした方が便利なのでは感じるようになりました。miに限らずどこでも使えるし。そこで次の記事では、<a href="http://rs.luminousspice.com/zencoding-automator-services/">automatorサービスを作る方法</a>を紹介します。</p></p>

<p><h2>ありがとう</h2>
<p>Perl実装した<a href="http://www.otchy.net/">Otchyさん</a>、Jedit Xマクロを書いた<a href="http://d.hatena.ne.jp/makog/">makogさん</a>、素晴らしい。
たったAppleScript10行でやりたいことが出来てしまった。ありがとうございます。</p></p>

<p>このブログを建てて記事を書いたのは、お二方に対する感謝の気持ちであります。</p>

  </article>
  <aside class="reference">
  
  
  </aside>
</div>

      <footer>
        <div class="footer">
          &copy; <time datetime="2016-03-21T14:35:52&#43;09:00">2016</time> luminousspice.com.
        </div>
      </footer>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-29141274-4', 'auto');
ga('send', 'pageview');
</script>


  </body>
</html>
