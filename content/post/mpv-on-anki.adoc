---
slug: "mpv-on-anki"
date: "2016-04-02T20:03:15+09:00"
lastmod: "2016-04-06T06:00:00+00:00"
title: "Anki のメディアプレイヤーを mpv に取り替える"
type: "post"
categories: ["Anki"]
tags: ["開発","アドオン","動画","メディア","mpv","VLC","afplay"]
excerpt: "Anki の標準メディアプレイヤー MPalyer をアドオンを使って取り替えてみましょう。高機能な軽量動画プレイヤーの mpv に切り替えると、カードに埋め込んだ動画の区間リピートやコマ送り再生ができるようになります。"
---
= Anki のメディアプレイヤーを mpv に変える
:author: luminousspice
:lang: ja
:encoding: UTF-8
:keywords:
:description: Anki の標準メディアプレイヤー MPalyer をアドオンを使って取り替えてみましょう。高機能な軽量動画プレイヤーの mpv に切り替えると、カードに埋め込んだ動画の区間リピートやコマ送り再生ができるようになります。
////
:toc: macro
:toc-placement:
:toclevels: 1
////
////
http://rs.luminousspice.com/mpv-on-anki/
////

{description}

//toc::[]

== Anki はメディアプレイヤーのカスタマイズを前提に作っていた

Anki はメディアプレイヤーとして外部ブログラムの MPlayer (MPlayer 1.1-4.2.1, Anki 2.0.35 の場合) を同梱して 使用しています。このため、動画再生時の制御方法を Anki  のマニュアルで取り上げられていません。


そこで、link:/mplayer-shortcut-for-anki-video/[ショートカットキー]をまとめたり、link:/html5-on-anki/[HTML5 を利用した Anki カードへのメディアの埋め込み] でユーザーインターフェイスを変更する方法を取り上げてきました。今回は、メディアプレイヤー自体を取り替える方法を紹介します。

コマンドラインで呼び出せるプレイヤーであれば、自分好みのアプリに設定し、動画再生機能を強化できます。
なお、OS X 版を前提として説明を進めます。

最近 reddit で https://www.reddit.com/r/Anki/comments/4c1ihg/does_anyone_use_vlc_with_anki/[Does anyone use VLC with Anki?] という面白い投稿を見つけました。MPlayer を VLC media player に変更する方法を取り上げています。

何がそんなに面白いかと言うと、Anki は、ユーザーがメディアプレイヤーを自由に変更することを前提に作っていることです。

Anki はメディアプレイヤーをカスタマイズするインターフェイスを標準で持っています。その使い方を Anki の作者が純正アドオン https://github.com/dae/ankiplugins/blob/master/customPlayer.py[customPlayer.py] を公開している説明していて、先ほどの投稿の中でも利用していました。

そこで高機能な軽量動画プレイヤーの link:https://mpv.io[mpv] を一つ具体例に取り上げて、Anki のメディアプレイヤーの交換方法を紹介したいと思います。

*参考:* https://github.com/dae/anki/blob/master/anki/sound.py[anki/sound.py]

== アドオンの設定方法

このアドオン https://github.com/dae/ankiplugins/blob/master/customPlayer.py[customPlayer.py] の使い方は、変更すべき箇所の直前のコメント中に書き込まれています。
初期設定 MPlayer の内容がコメントアウトで残されているので、引数の設定の参考にしてください。

.customPlayer.py 変更箇所
----
# change 'customPlayer' to the player you want
#externalPlayer = ["mplayer", "-really-quiet"]
externalPlayer = ["customPlayer"]
----

具体的な設定方法は、｀externalPlayer = ["customPlayer"]` の `customPlayer` を使いたいアプリのコマンドで置き換えます。
mpv に変更したい場合は、次のように指定します。

.mpv に交換する設定例
----
externalPlayer = ["mpv"]
----

変更したアドオンを、アドオンフォルダーに移動して Anki を再起動すると、新しいメディアプレイヤーが機能するようになります。

=== mpv で強化できる動画再生

mpv に変更すると Anki の動画再生機能に区間リピート (AB ループ) やコマ送り再生機能などが追加できます。
聞き逃した、見逃した箇所を繰り返し練習するのに重宝する機能です。

.mpv で区間リピート中
image::/images/mpv.png["mpv で区間リピート中"]

区間リピートやコマ送り再生のショートカットキーは次の通りです。

.mpv ショートカットキー
[frame="topbot",grid="rows",cols="^,9",options="header"]
|====
|キー| 操作内容
|l| AB ループ (区間リピート) の設定、解除
|, / .| 前後のフレーム (コマ送り再生; 一時停止して一フレーム再生)
|====

mpv の機能やショートカットは、link:https://mpv.io/manual/master/#keyboard-control[マニュアル]で詳しく調べることができます。

=== その他のアプリへの設定例

最初の参考情報で取り上げている VLC や、Quick Look に交換することもできます。高音質な音声を聴きたいなら afplay を指定することもできます。

.VLC media player の場合
----
externalPlayer = ["/Applications/VLC.app/Contents/MacOS/VLC", "--video-on-top", "--play-and-exit"]
----

.Quick Look の場合
----
externalPlayer = ["qlmanage", "-p"]
----

.afplay の場合 (高音質設定)
----
externalPlayer = ["afplay","-q","1"]
----

ここまで分かれば、セレクターを使って切り替えるとか、ノートからメディアプレイヤーを指定するとかアドオンのアイデアが沸いてきてお楽しみが増えますね。

Anki はユーザーがカスタマイズすることを前提に作られていて、いろいろな場所にその糸口が見つかります。
自分の好みに調節してさらに使いやすくするという Anki の楽しみ方も体験していただけたらと思います。