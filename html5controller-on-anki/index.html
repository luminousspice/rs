<!DOCTYPE html>
<html class="no-js" lang="ja" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
<meta name="description" content='HTML5 Video を使って Anki のカードに埋め込んだ動画の再生速度を調整するスライダーの作り方を紹介します。Anki のカードに JavaScript を使用する場合の注意点を盛り込んでいます。完成品をダウンロードして利用できます。'>
<meta name="keywords" content="Anki, HTML5, 開発, Python, JavaScript, 再生速度">

<meta property="og:type" content="article" />
<meta property="og:description" content='HTML5 Video を使って Anki のカードに埋め込んだ動画の再生速度を調整するスライダーの作り方を紹介します。Anki のカードに JavaScript を使用する場合の注意点を盛り込んでいます。完成品をダウンロードして利用できます。'/>
<meta property="og:title" content="Anki カードに埋め込んだ HTML5 Video の速度調整" />
<meta property="og:site_name" content="the Right Stuff" />
<meta property="og:url" content="https://rs.luminousspice.com/html5controller-on-anki/">
<meta property="og:locale" content="ja">
<meta property="og:image" content="https://rs.luminousspice.com/apple-touch-icon.png" />

<meta property="article:published_time" content="2016-05-21T13:49:38Z"/>
<meta property="article:modified_time" content="2016-05-21T13:49:38Z"/>



<meta property="article:tag" content="Anki"><meta property="article:tag" content="HTML5"><meta property="article:tag" content="開発"><meta property="article:tag" content="Python"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="再生速度">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@luminousspice">
<meta name="twitter:title" content="Anki カードに埋め込んだ HTML5 Video の速度調整">
<meta name="twitter:creator" content="@luminousspice">
<meta name="twitter:description" content='HTML5 Video を使って Anki のカードに埋め込んだ動画の再生速度を調整するスライダーの作り方を紹介します。Anki のカードに JavaScript を使用する場合の注意点を盛り込んでいます。完成品をダウンロードして利用できます。'>
<meta name="twitter:image:src" content="https://rs.luminousspice.com/apple-touch-icon.png">
<meta name="twitter:domain" content="luminousspice.com">

  <base href="https://rs.luminousspice.com/html5controller-on-anki/">
  <title>Anki カードに埋め込んだ HTML5 Video の速度調整 | the right stuff</title>

  <link rel="stylesheet" href="https://rs.luminousspice.com/css/rs.css">

  <link rel="apple-touch-icon" href="https://rs.luminousspice.com/apple-touch-icon.png">
  <link rel="shortcut icon" href="https://rs.luminousspice.com/favicon.ico" type="image/x-icon">
  
  <link rel="canonical" href="https://rs.luminousspice.com/html5controller-on-anki/">
  <link href="https://rs.luminousspice.com/index.xml" rel="alternate" type="application/rss+xml" title="the Right Stuff" />
  <link href="https://rs.luminousspice.com/index.xml" rel="feed" type="application/rss+xml" title="the Right Stuff" />
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    このコンテンツは @luminousspice が非同期的に更新しています。経時的な順序に意味はありません。
  </div>

  <nav class="sidebar-nav">
    
    <a class="sidebar-nav-item " href="https://rs.luminousspice.com/table-of-contents/">総目次</a>
    <a class="sidebar-nav-item " href="https://rs.luminousspice.com/index-how-to-anki/">Anki 索引</a>
    <a class="sidebar-nav-item " href="https://rs.luminousspice.com/post/">アーカイブ</a>
    <a class="sidebar-nav-item " href="https://rs.luminousspice.com/search/">全文検索</a>
    
    <a class="sidebar-nav-item" href="https://github.com/luminousspice">GitHub project</a>
  </nav>

  <div class="sidebar-item">
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://rs.luminousspice.com/" title="Home">the Right Stuff</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">Anki カードに埋め込んだ HTML5 Video の速度調整</h1>
  <span class="post-date"><time datetime="2016-05-21T13:49:38Z"></time>2016-05-21</span>
  <nav class="toc">
    <div id="toc"></div>
  </nav>
  <aside class="notice">
  
<div class="alert">
  <strong>注意:</strong> このページは、個人的な参照目的で保管しています。古いバージョンの Anki に基づいて作成しており、最新のバージョンでは変更されている可能性があります。
</div>


  </aside>
  <div class="post-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>HTML5 Video を使って Anki のカードに埋め込んだ動画の再生速度を調整するスライダーの作り方を紹介します。Anki のカードに JavaScript を使用する場合の注意点を盛り込んでいます。完成品をダウンロードして利用できます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_はじめに">はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rs.luminousspice.com/html5-on-anki/">Anki カードへの HTML5 メディアの埋め込み</a>では、HTML5 Video 要素を使ってカードに埋め込んだ動画を再生する方法を紹介しました。動画を教材とする場合、教材の学習効果を高めるために再生速度の調整をしたいことがよくあります。</p>
</div>
<div class="paragraph">
<p>HTML5 のメディア要素はタグだけでは速度調節できませんが JavaScript を使って制御できます。</p>
</div>
<div class="paragraph">
<p>ここまでは、普通に Web ページに動画を埋め込む作業と違いはありませんが、Anki に JavaScript を使い場合に若干の工夫が必要になります。そのための手法を紹介していきます。</p>
</div>
<div class="paragraph">
<p>まずは、完成品を見て頂きましょう。メディアプレイヤーの下にあるスライドバーが今回作成するコントロールです。再生中にスライダーを変化させると、再生速度が変化します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://rs.luminousspice.com/images/html5controller-anki.png" alt="HTML5 動画速度調節コントロール完成図">
</div>
<div class="title">図 1. HTML5 動画速度調節コントロール完成図</div>
</div>
<div class="paragraph">
<p>今回作成するのは、HTML5 で記述したメディアプレイヤーとスライダー、それを制御する JavaScript になります。</p>
</div>
<div class="paragraph">
<p>スライダーは jQuery のユーザーインターフェイスライブラリ jQuery UI を使って表示することにしました。理由は Anki の表示に利用していてファイルが組み込まれていて、追加ファイルの必要がないためです。</p>
</div>
<div class="paragraph">
<p>さらに JavaScript を読み込むためのアドオンの作成とJavaScript ライブラリが使用する CSS の配置方法を紹介します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_テンプレートの構成">テンプレートの構成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>今回は、基本ノートタイプから拡張した新規のノートタイプのテンプレートにメディアプレイヤーを記述していきます。動画ファイル名を格納するフィールドを追加しました。</p>
</div>
<div class="paragraph">
<div class="title">フィールドの構成</div>
<p><strong>Front:</strong> 質問内容 (既定のまま)<br>
<strong>Back:</strong> 解答内容 (既定のまま)<br>
<strong>Video:</strong> 質問中に表示する動画ファイル名 (URL を記述するとネット上の動画を表示)<br></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_html5_メディアの記述">HTML5 メディアの記述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTML の記述は、ウェブページを作成する場合と変わりありません。動画のファイル名が Video フィールドに格納されているので <code>{{Video}}</code> タグで表示します。</p>
</div>
<div class="paragraph">
<p><code>#slider</code> が、jQuery UI のスライダーを表示する領域、<code>#playbackRate</code> はスライダーを変化させた時の数値を表示する領域になります。</p>
</div>
<div class="listingblock">
<div class="title">表面テンプレートの内容</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;video id="video" controls&gt;
  &lt;source src="{{Video}}" type="video/mp4"&gt;
  &lt;source src="{{Video}}" type="video/3gpp"&gt;
  &lt;source src="{{Video}}" type="video/webm"&gt;
&lt;/video&gt;
&lt;br&gt;
&lt;div id="control"&gt;
再生速度(0.3〜3.0)：&lt;span id="playbackRate"&gt;1.0倍速&lt;/span&gt;&lt;div id="slider"&gt;&lt;/div&gt;&lt;/div&gt;
&lt;br&gt;{{Front}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_再生速度を制御する_javascript_の記述">再生速度を制御する JavaScript の記述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>再生速度を制御する JavaScript は、jQuery を使って記述しました。この点もウェブページの制作と変わりありません。</p>
</div>
<div class="listingblock">
<div class="title">再生速度を制御するスクリプト</div>
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">var video = document.getElementById("video");
var playbackRate  = document.getElementById("playbackRate");

$(function() {
    $("#slider").slider({
        value: 1.0,
        min: 0.3,
        max: 3.0,
        step: 0.1,
        slide: function(event, ui) {
            video.playbackRate = ui.value;
            playbackRate.innerHTML = ui.value.toFixed(1) + " 倍速";
        }
    });
    $("#playbackRate").val($("#slider").slider("value"));
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anki_で_javascript_を使う時に陥るワナ">Anki で JavaScript を使う時に陥るワナ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この JavaScript のコードと、jQuery UI のコード、CSS をテンプレートに直接書き込むと、カードレイアウトやブラウザのプレビュー機能では、表示され正しく機能します。しかし、実際の学習画面では機能しません。</p>
</div>
<div class="paragraph">
<p>理由は、プレビュー機能と学習画面では、コンテンツを書き出す方法が異なっているためです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_学習画面に_javascript_を読み込むアドオン">学習画面に JavaScript を読み込むアドオン</h2>
<div class="sectionbody">
<div class="paragraph">
<p>そこで通常のカードテンプレートやフィールドにスクリプトを書き込むのとは違った方法で、学習画面に表示するアドオンを作ります。</p>
</div>
<div class="paragraph">
<p>ということは、残念ながら今回の機能は、Anki PC 版でしか機能しません。</p>
</div>
<div class="paragraph">
<p>表面を表示する時に呼び出すフック <code>showQuestion</code> と裏面を表示する時に呼び出す フック <code>showAnswer</code> を使います。</p>
</div>
<div class="paragraph">
<p>先ほど説明した、再生速度調節のスクリプト (html5controller) と、Anki に同梱していますが学習画面では読み込まれていない jQuery UI (anki.js.ui) をフックを使って学習画面に読み込みます。</p>
</div>
<div class="listingblock">
<div class="title">学習画面に JavaScript を読み込むアドオン (html5controller.py)</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from anki.hooks import addHook
from aqt import mw
import anki.js


html5controller = u"""
var video = document.getElementById("video");
var playbackRate  = document.getElementById("playbackRate");

$(function() {
    $("#slider").slider({
        value: 1.0,
        min: 0.3,
        max: 3.0,
        step: 0.1,
        slide: function(event, ui) {
            video.playbackRate = ui.value;
            playbackRate.innerHTML = ui.value.toFixed(1) + " 倍速";
        }
    });
    $("#playbackRate").val($("#slider").slider("value"));
});
"""


def loadhtml5controller():
    """Load js to control playback rate of #video through #slider."""
    mw.web.eval(anki.js.ui)
    mw.web.eval(html5controller)

addHook("showQuestion", loadhtml5controller)
addHook("showAnswer", loadhtml5controller)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jquery_ui_css_の記述方法について">jQuery UI CSS の記述方法について</h2>
<div class="sectionbody">
<div class="paragraph">
<p>最後に JavaScript ライブラリが利用するスタイルシート <code>jquery-ui.css</code> の読み込み方を紹介しましょう。</p>
</div>
<div class="sect2">
<h3 id="_ファイルを読み込む方法">ファイルを読み込む方法</h3>
<div class="paragraph">
<p>ローカルに保存して使うのであれば、メディアフォルダーに <code>_jquery-ui.css</code> と名前を変更して配置します。</p>
</div>
<div class="paragraph">
<p>カードテンプレートに次のリンクを追加します。</p>
</div>
<div class="listingblock">
<div class="title">ローカルに配置する場合のリンク記述例</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;link rel="stylesheet" href="_jquery-ui.css"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDN などネット上のファイルを使うのであれば、上のファイル名に代えて URL を指定します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_テンプレートに直接記述する方法">テンプレートに直接記述する方法</h3>
<div class="paragraph">
<p>テンプレートの CSS 欄に <code>jquery-ui.css</code> の中でスライダーに関係する CSS だけを直接記述することもできます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_完成品のダウンロード">完成品のダウンロード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>今回作成したアドオンファイルとノートタイプが入った単語帳ファイルを公開しました。</p>
</div>
<div class="paragraph">
<p><a class="btn" href="https://rs.luminousspice.com/apkg/html5controller.zip" rel="nofollow"  onclick="ga('send', 'event', 'Downloads', 'AKPG', 'HTML5 メディアの速度調整');">ダウンロードファイル html5controller.zip</a></p>
</div>
<div class="sect2">
<h3 id="_ダウンロードファイルの使い方">ダウンロードファイルの使い方</h3>
<div class="paragraph">
<p>このダウンロードファイルを使うには次の手順でカードを作ってください。</p>
</div>
<div class="olist arabic">
<div class="title">ダウンロードファイルの利用手順</div>
<ol class="arabic">
<li>
<p><code>html5controller.zip</code> を解凍して <code>html5controller.py</code> と <code>html5controller.apkg</code> が含まれていることを確認します。</p>
</li>
<li>
<p>アドオンファイル <code>html5controller.py</code> をアドオンフォルダーに配置して、Anki を再起動します。</p>
</li>
<li>
<p>単語帳ファイル <code>html5controller.apkg</code> を開いて Anki に読み込みます。</p>
</li>
<li>
<p>ノートタイプ選択画面で <code>HTML5 Video Controller</code> を選択します。</p>
</li>
<li>
<p>Video フィールドに表示したいファイル名を入力します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>追加した単語帳 <code>HTML5 Video Controller</code> の中にはローカルの動画とネットの動画を表示する二枚のカードが含まれています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://rs.luminousspice.com/images/html5controller-anki.png" alt="ウンロードサンプル表示例">
</div>
<div class="title">図 2. ダウンロードサンプル表示例</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_まとめ">まとめ</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>HTML5 のメディア機能で動画の再生速度は JavaScript で制御できる。
*　Anki には、jQuery と jQuery UI が組み込まれているので追加ファイル不要で利用可能。</p>
</li>
<li>
<p>学習画面とプレビュー画面では読み込んだ JavaSript の動作が異なる場合がある。</p>
</li>
<li>
<p>学習画面でアドオンを使って JavaScript を読み込ませることができる。</p>
</li>
</ul>
</div>
</div>
</div>

  </div>
  <aside class="reference">
  
  
  </aside>
</div>

      <footer>
        <div class="footer">
          &copy; 2020 luminousspice.com.
        </div>
      </footer>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
var addtoc = function() {

  var threshold = 5;
  var toc = document.getElementById('toc');      
  var widget = document.querySelector('.toc');   
  var pre1 = document.querySelector('.sect1');   
  var pre2 = document.querySelector('#preamble');
  var headings = document.querySelectorAll('.post-content h2');
  if (!toc || !widget) {
    return;
  }
  if (headings.length < threshold) {
    return;
  }

  list = [];
  list.push('<div class="toc-title">この記事の内容</div><ol>');

    for (var i=0; i < headings.length; i++) {
      var h = headings[i];
      var d = document.createElement('a');
      var aname = 'i-' + i;
      d.name = aname;
      h.parentNode.insertBefore(d, h);
      var s = '<li><a href="https:\/\/rs.luminousspice.com\/html5controller-on-anki\/#' + aname + '">' + h.innerHTML + '</a></li>';
      list.push(s);
    }

  list.push('</ol>');
  toc.innerHTML = list.join("");
 
  if (pre2){
    pre2.appendChild(widget);
  } else {
    pre1.parentNode.insertBefore(widget, pre1); 
   }
}

addtoc();
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-29141274-4', 'auto');
	
	ga('send', 'pageview');
}
</script>



  </body>
</html>
