<!DOCTYPE html>
<html class="no-js" lang="ja" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
<meta name="description" content='Anki のカードに数式を表示するための LaTeX の設定方法を説明します。アドオンによる LaTeX の 処理内容のカスタマイズ、TikZ による図解表現、JavaScript のライブラリ MathJax を利用した表示方法についても取り上げます。'>
<meta name="keywords" content="Anki, LaTeX, 数式, TikZ, MathJax, アドオン">

<meta property="og:type" content="article" />
<meta property="og:description" content='Anki のカードに数式を表示するための LaTeX の設定方法を説明します。アドオンによる LaTeX の 処理内容のカスタマイズ、TikZ による図解表現、JavaScript のライブラリ MathJax を利用した表示方法についても取り上げます。'/>
<meta property="og:title" content="Anki ユーザーのための LaTeX 利用ガイド" />
<meta property="og:site_name" content="the Right Stuff" />
<meta property="og:url" content="http://rs.luminousspice.com/anki-latex-guide/">
<meta property="og:locale" content="ja">
<meta property="og:image" content="http://rs.luminousspice.com/apple-touch-icon.png" />

<meta property="article:published_time" content="2016-04-14T11:23:07Z"/>
<meta property="article:modified_time" content="2016-04-14T11:23:07Z"/>



<meta property="article:tag" content="Anki"><meta property="article:tag" content="LaTeX"><meta property="article:tag" content="数式"><meta property="article:tag" content="TikZ"><meta property="article:tag" content="MathJax"><meta property="article:tag" content="アドオン">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@luminousspice">
<meta name="twitter:title" content="Anki ユーザーのための LaTeX 利用ガイド">
<meta name="twitter:creator" content="@luminousspice">
<meta name="twitter:description" content='Anki のカードに数式を表示するための LaTeX の設定方法を説明します。アドオンによる LaTeX の 処理内容のカスタマイズ、TikZ による図解表現、JavaScript のライブラリ MathJax を利用した表示方法についても取り上げます。'>
<meta name="twitter:image:src" content="http://rs.luminousspice.com/apple-touch-icon.png">
<meta name="twitter:domain" content="luminousspice.com">

  <base href="http://rs.luminousspice.com">
  <title>Anki ユーザーのための LaTeX 利用ガイド | the right stuff</title>

  <link rel="stylesheet" href="http://rs.luminousspice.com/css/rs.css">

  <link rel="apple-touch-icon" href="http://rs.luminousspice.com/apple-touch-icon.png">
  <link rel="shortcut icon" href="http://rs.luminousspice.com/favicon.ico" type="image/x-icon">
  
  <link rel="canonical" href="http://rs.luminousspice.com/anki-latex-guide/">
  <link href="http://rs.luminousspice.com/index.xml" rel="alternate" type="application/rss+xml" title="the Right Stuff" />
  <link href="http://rs.luminousspice.com/index.xml" rel="feed" type="application/rss+xml" title="the Right Stuff" />
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    このコンテンツは @luminousspice が非同期的に更新しています。経時的な順序に意味はありません。
  </div>

  <nav class="sidebar-nav">
    
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/table-of-contents/">総目次</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/index-how-to-anki/">Anki 索引</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/post/">アーカイブ</a>
    <a class="sidebar-nav-item " href="http://rs.luminousspice.com/search/">全文検索</a>
    
  </nav>

  <div class="sidebar-item">
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="http://rs.luminousspice.com/" title="Home">the Right Stuff</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">Anki ユーザーのための LaTeX 利用ガイド</h1>
  <span class="post-date"><time datetime="2016-04-14T11:23:07Z"></time>2016-04-14</span>
  <nav class="toc">
    <div id="toc"></div>
  </nav>
  <div class="post-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Anki のカードに数式を表示するための LaTeX の設定方法を説明します。アドオンによる LaTeX の 処理内容のカスタマイズ、TikZ による図解表現、JavaScript のライブラリ MathJax を利用した表示方法についても取り上げます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anki_における_latex_処理の仕組み">Anki における LaTeX 処理の仕組み</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Anki における LaTeX の処理をザックリ説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>最初にカードに LaTeX 表現が使われていると Anki 内部から PC にインストールしている LaTeX 処理系のコマンドを呼び出して、png ファイルを作成し、表示します。</p>
</li>
<li>
<p>その際に、LaTeX の表現内容から SHA-1 ハッシュ値を計算し、ファイル名の一部として記録します。</p>
</li>
<li>
<p>次回以降は、このハッシュ値を比較し、更新があった時には画像を作成し直します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>画像などを保存するメディアフォルダ <code>(Anki フォルダ)\(プロファイル名)\collection.media</code> の中に latex-(40桁の英数字).png として保存しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_初期設定での処理内容">初期設定での処理内容</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Anki は、カードの中に LaTeX の表現があると次のコマンドを実行して画像化します。</p>
</div>
<div class="listingblock">
<div class="title">Anki 内部から呼び出す LaTeX 処理</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ latex -interaction=nonstopmode tmp.tex
$ dvipng -D 200 -T tight tmp.dvi -o tmp.png</code></pre>
</div>
</div>
<div class="paragraph">
<p>初期設定では、<code>latex</code> によって dvi ファイルを作り、<code>dvipng</code> を使って png ファイルを生成しています。</p>
</div>
<div class="sect2">
<h3 id="_latex_内容の一括画像化">LaTeX 内容の一括画像化</h3>
<div class="paragraph">
<p>複雑な表現だと画像生成に時間がかかり、学習の際に待ち時間が発生します。そのため事前に一括して画像化しておくことができます。</p>
</div>
<div class="paragraph">
<p>メニューバーから [ツール] - [メディアをチェック] を選択します。</p>
</div>
<div class="paragraph">
<p>iPhone アプリの AnkiMobile に LaTeX 表現を持ち込みたい場合も、この機能を使っておくと iPhone での数式表示ができます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_処理コマンドのカスタマイズ">処理コマンドのカスタマイズ</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://ankiweb.net/shared/info/937148547">Edit LaTeX build proces</a> を使うと、Anki 内部で呼び出すコマンドをカスタマイズできます。</p>
</div>
<div class="paragraph">
<p>使い方はアドオンファイルの <code>Edit_LaTeX_build_process.py</code> を開き、多重リスト <code>newLaTeX</code> の内容を編集します。</p>
</div>
<div class="listingblock">
<div class="title">Anki 初期設定のコマンド</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">newLaTeX = \
[
    ["latex", "-interaction=nonstopmode", "tmp.tex"],
    ["dvipng", "-D", "200", "-T", "tight", "tmp.dvi", "-o", "tmp.png"]
]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anki_のノートに_latex_を書く方法">Anki のノートに LaTeX を書く方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>基本的な表現は、特殊なタグ <code>[latex]</code> と <code>[/latex]</code> の間に書きます。
<code>\begin{document}</code> と <code>\end{document}</code> の間に表記すべき内容を書くことができます。</p>
</div>
<div class="paragraph">
<p>その外側に指定したい内容の書き方は、後述の TikZ パッケージの導入で説明します。</p>
</div>
<div class="paragraph">
<p>なお、ノート内に LaTeX を使うタグには省略表記が使えます。</p>
</div>
<table class="tableblock frame-topbot grid-rows spread">
<caption class="title">表 1. latex 記述タグの省略表記</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">省略形</th>
<th class="tableblock halign-left valign-top">元の表現</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$] &#8230;&#8203; [/$]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[latex]\begin{math} &#8230;&#8203; \end{math}[/latex]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$$] ... [/$$]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[latex]\begin{displaymath} &#8230;&#8203; \end{displaymath}[/latex]</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_tikz_を使う">TikZ を使う</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Anki では、TikZ パッケージを使った図解表現を表示することもできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://rs.luminousspice.com/images/latex-tikz.png" alt="TikZ を利用したカード">
</div>
<div class="title">図 1. TikZ を利用したカード</div>
</div>
<div class="sect2">
<h3 id="_tikz_パッケージの導入">TikZ パッケージの導入</h3>
<div class="paragraph">
<p>TikZ パッケージを読み込むためのプリアンブル設定方法を紹介します。プリアンブルはノートタイプごとに指定できます。</p>
</div>
<div class="olist arabic">
<div class="title">プリアンブル設定</div>
<ol class="arabic">
<li>
<p>メニューバーから [ツール] - [ノートタイプを管理]</p>
</li>
<li>
<p>カードが使用しているノートタイプを選択して、[オプション] を選択</p>
</li>
<li>
<p>ヘッダー欄で必要な設定項目を入力</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="http://rs.luminousspice.com/images/latex-option.png" alt="TikZ パッケージ設定">
</div>
<div class="title">図 2. TikZ パッケージ設定</div>
</div>
</div>
<div class="sect2">
<h3 id="_コマンドのカスタマイズ">コマンドのカスタマイズ</h3>
<div class="paragraph">
<p>Anki の初期状態のコマンドでは、TikZ を使用できないため、先ほどのアドオンを使って変更します。</p>
</div>
<div class="paragraph">
<p>pdflatex によって PDF ファイルを作り、その次に ImageMagick を使って PNG ファイルを生成する例を紹介します。</p>
</div>
<div class="listingblock">
<div class="title">tikz のための設定例</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">newLaTeX = \
[
    ["pdflatex", "-interaction=nonstopmode", "tmp.tex"],
    ["convert", "-trim", "-density", "300", "tmp.pdf", "tmp.png"]
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anki_で_latex_を使う場合の注意点">Anki で LaTeX を使う場合の注意点</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Anki のサポートサイトで LaTeX に関する投稿が繰り返し寄せられていますが、Anki 外の問題も多いようです。
最初に準備しておきたい項目をまとめました。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anki を使う前に、PC に使用する LaTeX システムが正しくインストールできているか確認する。</p>
</li>
<li>
<p>使用する表現をコマンドラインを使って表示できるか事前に表示する。</p>
</li>
<li>
<p>問題が発生した場合は、Anki のカード面に表示するエラーメッセージをよく読み、コマンドラインでも発生するか確認する。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mathjax_の使い方">MathJax の使い方</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LaTeX 処理系のインストールを必要としない、JavaScritp ライブラリの <a href="https://www.mathjax.org/">MathJax</a> を使った LaTeX の数式の表示方法を取り上げましょう。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://rs.luminousspice.com/images/latex-mathjax.png" alt="MathJax 表示例">
</div>
<div class="title">図 3. MathJax 表示例</div>
</div>
<div class="paragraph">
<p>MathJax を Anki のカードで使うには、テンプレートに MathJax を呼び出すスクリプトを書き込みます。
例えば表面のテンプレートに、次のようなタグを追加します。</p>
</div>
<div class="listingblock">
<div class="title">テンプレート記述例</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">&lt;script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/2.5-latest/MathJax.js?config=TeX-AMS_HTML"&gt;
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_注意事項">注意事項</h3>
<div class="paragraph">
<div class="title">バージョン指定</div>
<p>私の環境では、最新の 2.6 系列は [Math Processing Error] が発生して表示できませんでしたので 2.5 を指定しています。</p>
</div>
<div class="paragraph">
<div class="title">ローカルファイルから呼び出しについて</div>
<p>Anki は、メディアフォルダーのサブディレクトリの呼び出しができません。<code>MathJax.js</code> がサブディレクトリを読むことができません。</p>
</div>
<div class="paragraph">
<div class="title">アドオンについて</div>
<p>以前 MathJax を使うためのアドオンが公開されていましたが、現在では削除されています。このためテンプレートに直接呼び出しスクリプトを書き込む方法を紹介しました。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_まとめ">まとめ</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Anki は、内部的に LaTeX 表記を画像にして保存している。</p>
</li>
<li>
<p>Anki がする生成した画像は、ソースの LaTeX に変更があると作り直す。</p>
</li>
<li>
<p>Anki が呼び出すコマンドは、アドオンでカスタマイズ可能。</p>
</li>
<li>
<p>LaTeX のプリアンブルは、ノートタイプごとに指定でき、パッケージの追加ができる。</p>
</li>
<li>
<p>MathJax は、カードテンプレートから外部共有ファイルへの参照を記述すれば可能。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_参考情報">参考情報</h3>
<div class="ulist">
<ul>
<li>
<p>Anki ソースファイル <a href="https://github.com/dae/anki/blob/master/anki/latex.py">anki/latex.py</a></p>
</li>
<li>
<p><a href="http://www.opt.mist.i.u-tokyo.ac.jp/~tasuku/tikz.html">BeamerのためのTikZ</a></p>
</li>
<li>
<p><a href="http://tex.stackexchange.com/questions/119349/what-preamble-does-math-stackexchange-com-use">What preamble does math.stackexchange.com use?</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>

  </div>
  <aside class="reference">
  
  
  </aside>
</div>

      <footer>
        <div class="footer">
          &copy; 2016 luminousspice.com.
        </div>
      </footer>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
var addtoc = function() {

  var threshold = 5;
  var toc = document.getElementById('toc');      
  var widget = document.querySelector('.toc');   
  var pre1 = document.querySelector('.sect1');   
  var pre2 = document.querySelector('#preamble');
  var headings = document.querySelectorAll('.post-content h2');
  if (!toc || !widget) {
    return;
  }
  if (headings.length < threshold) {
    return;
  }

  list = [];
  list.push('<div class="toc-title">この記事の内容</div><ol>');

    for (var i=0; i < headings.length; i++) {
      var h = headings[i];
      var d = document.createElement('a');
      var aname = 'i-' + i;
      d.name = aname;
      h.parentNode.insertBefore(d, h);
      var s = '<li><a href="http:\/\/rs.luminousspice.com\/anki-latex-guide\/#' + aname + '">' + h.innerHTML + '</a></li>';
      list.push(s);
    }

  list.push('</ol>');
  toc.innerHTML = list.join("");
 
  if (pre2){
    pre2.appendChild(widget);
  } else {
    pre1.parentNode.insertBefore(widget, pre1); 
   }
}

addtoc();
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-29141274-4', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
